#!/bin/bash

if [ -z "$1" ]; then
    echo "Please provide a python script name after "$0"."
    exit
fi

SCRIPT_DIR="$(dirname "$1")"
if [ -d $SCRIPT_DIR ]; then
    SCRIPT_ABS_PATH="$(cd "$(dirname "$1")"; pwd)/$(basename "$1")"
fi

if [ -f $SCRIPT_ABS_PATH ]; then
    SCRIPT_PATH=$SCRIPT_ABS_PATH
fi

if [ -z "$SCRIPT_PATH" ]; then
    args=("$@")
    SCRIPT_BASENAME=`basename ${args[0]}`
    SCRIPT_PATH=$NEMD_SCRIPTS/$SCRIPT_BASENAME
fi

if [ ! -f $SCRIPT_PATH ]; then
    echo "Neither $SCRIPT_PATH or $SCRIPT_ABS_PATH exist."
    exit
fi

SCRIPT_ARGS="$SCRIPT_PATH ${@:2}"

for ((i=0; i<=$#; i++)); do

  if [ ${!i} == '-JOBNAME' ]; then
    j=$(( $i + 1 ))
    export JOBNAME=${!j}
    [[ -z "$JOBNAME" ]] && echo "Please provide a jobname after -JOBNAME flag" && exit
    echo "$JOBNAME set as the JOBNAME"
  fi

  if [ ${!i} == '-INTERACTIVE' ]; then
    export INTERACTIVE='1'
  fi

  if [ ${!i} == '-DEBUG' ]; then
    export DEBUG='1'
  fi

done

echo "Running python3 $SCRIPT_PATH"

env FOO=BAR python3 $SCRIPT_ARGS